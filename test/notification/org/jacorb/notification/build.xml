<?xml version="1.0" encoding="iso-8859-1"?>

<!DOCTYPE project [ <!ENTITY common SYSTEM "file:../../../../../common.xml"> ]>

<project name="notification" default="notification.test" basedir="../../../../..">

  &common;

  <target name="notification.test.init" depends="init">
    <property name="notification.base" value="${basedir}/src/org/jacorb/notification" />

    <loadproperties srcFile="${notification.base}/notification_build.properties"/>

    <path id="notification.classpath">
      <pathelement location="${basedir}/classes" />
      <pathelement location="${antlr.home}/antlr.jar" />
      <pathelement location="${concurrent.home}/lib/concurrent.jar" />
      <pathelement location="${junit.home}/junit.jar" />
      <pathelement location="${log4j.home}/dist/lib/log4j-${log4j.version}.jar" />
    </path>

    <property name="test.dir" value="${basedir}/test/notification" />
    <property name="compile.option.debug" value="true"/>

    <property name="rt.file" value="notification.jar" />
    <property name="dist-src.file" value="notification-src.zip" />

    <mkdir dir="${test.dir}/generated" />

    <taskdef
      name="jacidl"
      classname="org.jacorb.idl.JacIDL"
      classpathref="notification.classpath" />

  </target>

  <target name="notification.test" depends="notification.test.init, tcl-test, server-test">
  </target>

  <target 
    name="tcl-test" 
    depends="tcl-test.generate, tcl-test.compile, tcl-test.run" />

  <target name="tcl-test.generate" depends="notification.test.init">
    <jacidl srcdir="${test.dir}/org/jacorb/notification/node"
      packageprefix="org.jacorb.notification"
      destdir="${test.dir}/generated" />
  </target>

  <target name="tcl-test.compile" depends="notification.test.init, tcl-test.generate">
    <javac debug="${compile.option.debug}"
      destdir="${classdir}"
      classpathref="notification.classpath" >
      <src path="${test.dir}" />
      <src path="${test.dir}/generated" />
      <include name="org/jacorb/notification/test/**" />
      <include name="org/jacorb/notification/node/**" />
      </javac>
  </target>

  <target name="tcl-test.run" depends="notification.test.init">
    <junit printsummary="yes" fork="yes" haltonerror="yes">
      <sysproperty key="user.home" value="${jacorb_properties.path}" />

      <sysproperty 
	  key="org.omg.CORBA.ORBClass"
	  value="org.jacorb.orb.ORB" />

      <sysproperty 
	    key="org.omg.CORBA.ORBSingletonClass"
	    value="org.jacorb.orb.ORBSingleton" />

      <formatter usefile="false" type="plain"/>
      <classpath refid="notification.classpath" />
      <test name="org.jacorb.notification.node.TCLTest" />
    </junit>
  </target>

    <target name="server-test" depends="notification.test.init,
    server-test.compile, server-test.run" />
      

  <target name="server-test.compile" depends="notification.test.init">
    <javac debug="${compile.option.debug}" srcdir="${test.dir}"
      includes="org/jacorb/notification/**.java, org/jacorb/notification/util/**.java"
      destdir="${classdir}"
      classpathref="notification.classpath" />
  </target>

  <target name="server-test.run" depends="notification.test.init">
    <junit printsummary="yes" fork="yes" haltonerror="yes">

      <classpath refid="notification.classpath" />

      <sysproperty key="user.home" value="${jacorb_properties.path}"/>

      <sysproperty 
	    key="org.omg.CORBA.ORBClass"
	    value="org.jacorb.orb.ORB" />

      <sysproperty 
	      key="org.omg.CORBA.ORBSingletonClass"
	      value="org.jacorb.orb.ORBSingleton" />

      <formatter usefile="false" type="plain" />
	  
      <test name="org.jacorb.notification.util.WildcardMapTest" />
      <test name="org.jacorb.notification.FilterTest" /> 
      <test name="org.jacorb.notification.EventChannelTest" />
      <test name="org.jacorb.notification.NotificationEventFactoryTest" />
<!--      <test name="org.jacorb.notification.StructuredEventChannelTest" />  -->
    </junit>
  </target>

  <target name="clean" depends="notification.test.init">
    <delete dir="${test.dir}/generated" />

    <delete>
      <fileset dir="${classdir}"
	includes="org/jacorb/notification/**/*Test.*" />
    </delete>
  </target>

</project>

