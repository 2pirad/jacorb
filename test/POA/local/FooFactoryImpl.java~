package test.POA.local;

import org.omg.PortableServer.*;

public class FooFactoryImpl 
    extends FooFactoryPOA 
{
    private static FooImpl single = new FooImpl();
 
    public POA _default_POA() 
    {
            org.omg.CORBA.ORB orb
                = org.omg.CORBA.ORB.init((String[])null, null);
            POA rootPOA = 
                POAHelper.narrow(orb.resolve_initial_references("RootPOA"));

        try 
        {
            return rootPOA.find_POA(Server.factoryPOAName, false);			
        } 
        catch(org.omg.PortableServer.POAPackage.AdapterNonExistent e) 
        {
            System.out.println("POA " + Server.factoryPOAName + " not found.");
            e.printStackTrace();
            return rootPOA;
        }
    }

    public Foo createFoo(String id) 
    {
        Foo result = null;
        try 
        {
            POA fooPOA = _default_POA().find_POA(Server.fooPOAName, true);

            byte[] oid = id.getBytes();
            result = FooHelper.narrow(fooPOA.create_reference_with_id(oid, FooHelper.id()));

        } 
        catch (Exception e) 
        {
            e.printStackTrace();
        }
        System.out.println("[ Foo created with id: "+id+" ]");
        return result;
    }

}
