
The Security Attribute Service (SAS) is part of the Common Secure 
Interoperability Specification, Version 2 (CSIv2) CORBA specification.
It is defined in the Secure Interoperability chapter (chapter 24) of the
CORBA 3.0.2 Specification.

\section{Overview}

The SAS specification defines the interchange between a Client Security 
Service (CSS) and a Target Security Service (TSS)
for the exchange of security authentication and authorization
elements. This information is exchanged in the Service Context of the GIOP
request and reply messages. The SAS may be used in conjunction with SSL to
provide privacy of the messages being sent and received.

The SAS service is implemented as a series of standard CORBA interceptors,
one for the CSS and one for the TSS. The service also uses a user specified
SAS context class to support different authentication mechanisms, such as
GSSUP and Kerberos.

The SAS service is activated based on entries in the JacORB properties file.
The properties are slightly different for a CSS and a TSS application.

The following is a part of the JacORB properties file that is used by 
the CSS.

\begin{scriptsize}
\begin{verbatim}
########################################
#                                      #
#   SAS configuration                  #
#                                      #
########################################

# This option initializes SAS support in the ORB and sets the logging level
jacorb.security.support_sas=on
jacorb.SAS.log.verbosity=3

# This option configures the SAS to support stateful sessions (default=true)
jacorb.security.sas.tss.stateful=true

# This option defines the specific SAS context generator/validator
# Currently supported contexts include:
#    GssUpContext      - Uses GSSUP security
#    KerberosContext   - uses Kerberos security
jacorb.security.sas.contextClass=org.jacorb.security.sas.GssUpContext
#jacorb.security.sas.contextClass=org.jacorb.security.sas.KerberosContext

# This initializer installs the SAS Target Security Service (TSS)
#org.omg.PortableInterceptor.ORBInitializerClass.SASTarget=org.jacorb.security.sas.SASTargetInitializer

# This initializer installs the SAS Client Security Service (CSS)
org.omg.PortableInterceptor.ORBInitializerClass.SASClient=org.jacorb.security.sas.SASClientInitializer

# This option is used for GSSUP security and sets up the GSS Provider
org.omg.PortableInterceptor.ORBInitializerClass.GSSUPProvider=org.jacorb.security.sas.
GSSUPProviderInitializer

# This option identifies the layered security attributes required by the target
# Attributes are entered in a comma-separated list. Valid attributes are:
#       Integrity
#       Confidentiality
#       EstablishTrustInTarget
#       EstablishTrustInClient
#       IdentityAssertion
#       DelegationByClient
#jacorb.security.sas.tss.target_supports=EstablishTrustInTarget
#jacorb.security.sas.tss.target_requires=EstablishTrustInTarget
\end{verbatim}
\end{scriptsize}


The following is a part of the JacORB properties file that is used by 
the TSS.

\begin{scriptsize}
\begin{verbatim}
########################################
#                                      #
#   SAS configuration                  #
#                                      #
########################################

# This option initializes SAS support in the ORB and sets the logging level
jacorb.security.support_sas=on
jacorb.SAS.log.verbosity=3

# This option configures the SAS to support stateful sessions (default=true)
jacorb.security.sas.tss.stateful=true

# This option defines the specific SAS context generator/validator
# Currently supported contexts include:
#    GssUpContext      - Uses GSSUP security
#    KerberosContext   - uses Kerberos security
jacorb.security.sas.contextClass=org.jacorb.security.sas.GssUpContext
#jacorb.security.sas.contextClass=org.jacorb.security.sas.KerberosContext

# This initializer installs the SAS Target Security Service (TSS)
org.omg.PortableInterceptor.ORBInitializerClass.SASTarget=org.jacorb.security.sas.SASTargetInitializer

# This initializer installs the SAS Client Security Service (CSS)
#org.omg.PortableInterceptor.ORBInitializerClass.SASClient=org.jacorb.security.sas.SASClientInitializer

# This option is used for GSSUP security and sets up the GSS Provider
org.omg.PortableInterceptor.ORBInitializerClass.GSSUPProvider=org.jacorb.security.sas.
GSSUPProviderInitializer

# This option identifies the layered security attributes required by the target
# Attributes are entered in a comma-separated list. Valid attributes are:
#       Integrity
#       Confidentiality
#       EstablishTrustInTarget
#       EstablishTrustInClient
#       IdentityAssertion
#       DelegationByClient
jacorb.security.sas.tss.target_supports=EstablishTrustInTarget
jacorb.security.sas.tss.target_requires=EstablishTrustInTarget
\end{verbatim}
\end{scriptsize}

In some cases, an application may act as both a CSS and a TSS. 
In these cases, a single properties file may be used with both the
CSS and TSS interceptors included.

\section{GSSUP Example}

The GSSUP (GSS Username/Password) example demonstrates the simplest 
usage of the SAS service. In this example, username and password
pairs are send via the SAS service. The client registers its username
and password with the GSSUP Context which is later used CSS interceptor
to generate the user's authentication information.
The TSS retrieves the username and password
without validating them. It is assumed by the TSS that the username
and password are correct and/or will be further validated by a later
interceptor or application code.

The following describes a SAS example using GSSUP.

\subsection{GSSUP IDL Example}

\begin{scriptsize}
\begin{verbatim}
module demo{
  module sas{
    interface SASDemo{
      void printSAS();
    };
  };
};
\end{verbatim}
\end{scriptsize}

The IDL contains a single interface. This interface is used to print out
the user principal sent and received by the SAS service.

\subsection{GSSUP Client Example}

The following is a sample GSSUP client.

\begin{scriptsize}
\begin{verbatim}
package demo.sas;

import java.io.BufferedReader;
import java.io.File;
import java.io.FileReader;

import org.jacorb.security.sas.GssUpContext;
import org.omg.CORBA.ORB;

public class GssUpClient {
    public static void main(String args[]) {
        if (args.length != 3) {
            System.out.println("Usage: java demo.sas.GssUpClient <ior_file> <username> <password>");
            System.exit(1);
        }

        try {
            // set security credentials
            GssUpContext.setUsernamePassword(args[1], args[2]);

            // initialize the ORB.
            ORB orb = ORB.init(args, null);

            // get the server
            File f = new File(args[0]);
            if (!f.exists()) {
                System.out.println("File " + args[0] + " does not exist.");
                System.exit(-1);
            }
            if (f.isDirectory()) {
                System.out.println("File " + args[0] + " is a directory.");
                System.exit(-1);
            }
            BufferedReader br = new BufferedReader(new FileReader(f));
            org.omg.CORBA.Object obj = orb.string_to_object(br.readLine());
            br.close();
            SASDemo demo = SASDemoHelper.narrow(obj);

            //call single operation
            demo.printSAS();
            demo.printSAS();
            demo.printSAS();

            System.out.println("Call to server succeeded");
        } catch (Exception ex) {
            ex.printStackTrace();
        }
    }
}
\end{verbatim}
\end{scriptsize}

The key to the client is the call to:
\begin{scriptsize}
\begin{verbatim}
    GssUpContext.setUsernamePassword(args[1], args[2]);
\end{verbatim}
\end{scriptsize}
This call registers the client's username and password with the GSSUP context.
This information will then later be used by the CSS interceptor as the user's
authentication information.

The following is JacORB properties section for the client SAS.

\begin{scriptsize}
\begin{verbatim}
jacorb.security.support_sas=on
jacorb.SAS.log.verbosity=3
jacorb.security.sas.tss.stateful=true
jacorb.security.sas.contextClass=org.jacorb.security.sas.GssUpContext
org.omg.PortableInterceptor.ORBInitializerClass.SASClient=org.jacorb.security.sas.SASClientInitializer
org.omg.PortableInterceptor.ORBInitializerClass.GSSUPProvider=org.jacorb.security.sas.GSSUPProviderInitializer
\end{verbatim}
\end{scriptsize}

\subsection{GSSUP Target Example}

The following is a sample GSSUP target.

\begin{scriptsize}
\begin{verbatim}
package demo.sas;

import java.io.FileWriter;
import java.io.PrintWriter;

import org.jacorb.security.sas.GssUpContext;
import org.omg.PortableServer.POA;
import org.omg.CORBA.ORB;

public class GssUpServer extends SASDemoPOA {
    private ORB orb;

    public GssUpServer(ORB orb) {
        this.orb = orb;
    }

    public void printSAS() {
        try {
            org.omg.PortableInterceptor.Current current = 
                (org.omg.PortableInterceptor.Current) orb.resolve_initial_references("PICurrent");
            org.omg.CORBA.Any anyName = 
                current.get_slot(org.jacorb.security.sas.SASTargetInitializer.sasPrincipalNamePIC);
            String name = anyName.extract_string();
            System.out.println("printSAS for user " + name);
        } catch (Exception e) {
            System.out.println("printSAS Error: " + e);
        }
    }

    public static void main(String[] args) {
        if (args.length != 1) {
            System.out.println("Usage: java demo.sas.GssUpServer <ior_file>");
            System.exit(-1);
        }

        try {
            // initialize the ORB and POA.
            ORB orb = ORB.init(args, null);
            POA poa = (POA) orb.resolve_initial_references("RootPOA");
            poa.the_POAManager().activate();
			
            // create object and write out IOR
            org.omg.CORBA.Object demo = poa.servant_to_reference(new GssUpServer(orb));
            PrintWriter pw = new PrintWriter(new FileWriter(args[0]));
            pw.println(orb.object_to_string(demo));
            pw.flush();
            pw.close();
			
            // run the ORB
            orb.run();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
\end{verbatim}
\end{scriptsize}

The following is JacORB properties section for the target SAS.

\begin{scriptsize}
\begin{verbatim}
jacorb.security.support_sas=on
jacorb.SAS.log.verbosity=3
jacorb.security.sas.tss.stateful=true
jacorb.security.sas.contextClass=org.jacorb.security.sas.GssUpContext
org.omg.PortableInterceptor.ORBInitializerClass.SASTarget=org.jacorb.security.sas.SASTargetInitializer
org.omg.PortableInterceptor.ORBInitializerClass.GSSUPProvider=org.jacorb.security.sas.GSSUPProviderInitializer
jacorb.security.sas.tss.target_supports=EstablishTrustInTarget
jacorb.security.sas.tss.target_requires=EstablishTrustInTarget
\end{verbatim}
\end{scriptsize}

%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "../ProgrammingGuide"
%%% End: 
