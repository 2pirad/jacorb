<?xml version="1.0"?>

<!DOCTYPE project [
  <!ENTITY common  SYSTEM "file:../../../../../../etc/common.xml">
  <!ENTITY xdoclet SYSTEM "file:../../../../../../etc/common-xdoclet.xml">
]>

<!-- $Id: build.xml,v 1.5 2005-10-22 12:03:25 alphonse.bendt Exp $ -->
<project name="jboss-cosnotification" default="sar" basedir="../../../../../..">
	
	&common;
	
	<property file="${basedir}/build.properties" />
	<property environment="env" />
	
	<target name="locate-jboss" unless="jboss.home">
		<fail unless="${env.JBOSS_HOME}" message="unable to locate JBoss. Either add jboss.home=... to build properties, invoke ant with -Djboss.home=... or set the environment variable JBOSS_HOME=..."/>
		<property name="jboss.home" value="${env.JBOSS_HOME}" />
		<echo level="verbose" message="set jboss.home to ${jboss.home}" />
	</target>
	
	<target name="init.local" depends="init, locate-jboss">
		<property name="pkg.project" value="org/jacorb/notification/jmx" />
		<property name="dir.project" value="${src}/${pkg.project}" />

		<property name="name.artifact" value="jboss-cosnotification" />
		<property name="name.jar" value="${name.artifact}.jar" />
		<property name="name.sar" value="${name.artifact}.sar" />

		<property name="path.sar" value="${lib}/${name.sar}" />
		<property name="path.jar" value="${lib}/${name.jar}" />

		<property name="dir.deploy" value="${jboss.home}/server/all/deploy" />

		<path id="classpath">
			<pathelement location="${jacorb.home}/lib/jacorb.jar" />
			<pathelement location="${jacorb.home}/lib/picocontainer-1.2.jar" />
			<pathelement location="${jacorb.home}/lib/backport-util-concurrent.jar" />
			<pathelement location="${jboss.home}/lib/jboss-system.jar" />
			<pathelement location="${jboss.home}/lib/jboss-jmx.jar" />
			<pathelement location="${jboss.home}/lib/jboss-common.jar" />
			<pathelement location="${jboss.home}/lib/dom4j.jar" />
			<pathelement location="${jboss.home}/server/all/lib/avalon-framework.jar" />
			<pathelement location="${jboss.home}/server/all/lib/jboss-iiop.jar" />
		</path>
	</target>

	<target name="compile.jacorb" >
		<ant antfile="${basedir}/src/org/jacorb/notification/build.xml" target="jmx" >
			<property name="jbossmx.enabled" value="true" />
		</ant>
	</target>
	
	<target name="compile" depends="init.local, compile.jacorb">
		<jacorb-javac javac-includes="${pkg.project}/*.java, ${pkg.project}/jboss/*.java" javac-classpathref="classpath" />
	</target>

	<target name="jar" depends="init.local, compile">
		<jar destfile="${path.jar}" basedir="${classdir}">
			<include name="${pkg.project}/jboss/*.class" />

			<fileset dir="${src}/generated">
				<include name="${pkg.project}/jboss/*.xml" />
			</fileset>
		</jar>
	</target>

	<target name="sar" depends="init.local, jar" description="build the JacORB COSNotification JBoss-SAR" >
		<jar destfile="${path.sar}">
			<fileset dir="${lib}">
				<include name="${name.jar}" />
			</fileset>

			<zipfileset dir="${src}/${pkg.project}/jboss" prefix="META-INF">
				<include name="jboss-service.xml" />
			</zipfileset>

			<zipfileset file="${lib}/backport-util-concurrent.jar" />
			<zipfileset file="${lib}/picocontainer-1.2.jar" />
		</jar>
	</target>

	<target name="deploy" depends="init.local, sar">
		<copy todir="${dir.deploy}" file="${path.sar}" />
	</target>

	<target name="clean" depends="init.local">
		<delete file="${path.sar}" />
		<delete file="${path.jar}" />
	</target>

</project>