<?xml version="1.0"?>

<!DOCTYPE project [ <!ENTITY common SYSTEM "file:../../../../etc/common.xml"> ]>

<project name="idl" default="all" basedir="../../../..">

   &common;

   <target name="all" depends="init, check, parser" >
      <!-- This replace is safety addition so if parser.cup has been -->
      <!-- regenerated then it will still build. Normally this will  -->
      <!-- have no affect and not alter parser.java                  -->
      <replace file="${src.generated}/org/jacorb/idl/parser.java" token="java_cup.runtime"
         value="org.jacorb.idl.runtime" />
	
   	<jacorb-javac javac-includes="org/jacorb/idl/**/*.java"/>
   </target>

    <target name="check" >
        <uptodate property="parser.notRequired" srcfile="${src}/org/jacorb/idl/parser.cup">
            <compositemapper>
                <mergemapper to="${src.generated}/org/jacorb/idl/parser.java" />
                <mergemapper to="${src.generated}/org/jacorb/idl/sym.java" />
            </compositemapper>
        </uptodate>
    </target>

    <target name="parser" unless="parser.notRequired" >
        <mkdir dir="${src.generated}/org/jacorb/idl" />
        <java classname="java_cup.Main" fork="true" dir="${src.generated}/org/jacorb/idl" input="${src}/org/jacorb/idl/parser.cup" >
            <classpath>
                <pathelement path="${basedir}/lib/build/java_cup.jar" />
            </classpath>
        </java>
    </target>
</project>
